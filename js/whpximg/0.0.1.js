class ImageViewer extends HTMLElement{constructor(){super();this.canvas=document.createElement('canvas');this.context=this.canvas.getContext('2d');this.appendChild(this.canvas)}connectedCallback(){const filePath=this.getAttribute('src');this.loadFromURL(filePath)}async loadFromURL(url){try{const response=await fetch(url);const buffer=new Uint8Array(await response.arrayBuffer());this.loadImage(buffer)}catch(error){console.error("画像の読み込みに失敗しました:",error)}}loadImage(buffer){const header=this.parseHeader(buffer);this.canvas.width=header.width;this.canvas.height=header.height;const imageData=this.context.createImageData(header.width,header.height);this.fillImageData(imageData.data,buffer,header);this.context.putImageData(imageData,0,0)}parseHeader(buffer){return{identifier:buffer.slice(0,2),compatibility:buffer[2],width:buffer.readUInt32BE(3),height:buffer.readUInt32BE(7)}}fillImageData(dataArray,buffer,header){for(let i=0;i<header.width*header.height;i++){const pixelData=buffer.slice(11+i*4,15+i*4);dataArray[i*4]=pixelData[0];dataArray[i*4+1]=pixelData[1];dataArray[i*4+2]=pixelData[2];dataArray[i*4+3]=255}}} customElements.define('whpximg',ImageViewer)
